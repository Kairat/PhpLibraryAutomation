

<!DOCTYPE html>
<html class="writer-html5" lang="ru" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Библиотека PhpIrbis &mdash; документация PhpIrbis 0.4</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Алфавитный указатель" href="genindex.html" />
    <link rel="search" title="Поиск" href="search.html" />
    <link rel="next" title="Класс Connection" href="chapter2.html" />
    <link rel="prev" title="Библиотека PhpIrbis" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PhpIrbis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Содержание</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Библиотека PhpIrbis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Введение</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Установка</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Примеры программ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="chapter2.html">Класс Connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter6.html">);</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter6.html#id24">}</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PhpIrbis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Библиотека PhpIrbis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/chapter1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="phpirbis">
<h1>Библиотека PhpIrbis<a class="headerlink" href="#phpirbis" title="Ссылка на этот заголовок">¶</a></h1>
<div class="section" id="id1">
<h2>Введение<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">PhpIrbis</span></code> представляет собой простую библиотеку для создания клиентских приложений для системы автоматизации библиотек ИРБИС64 на языке PHP.</p>
<p>Пакет не содержит неуправляемого кода и не требует <code class="docutils literal notranslate"><span class="pre">irbis64_client.dll</span></code>. Успешно работает на 32-битных и 64-битных версиях операционных систем Windows, MacOS X и Linux.</p>
<p>Основные возможности пакета:</p>
<ul class="simple">
<li><p>Поиск и расформатирование записей.</p></li>
<li><p>Создание и модификация записей, сохранение записей в базе данных на сервере.</p></li>
<li><p>Работа с поисковым словарем: просмотр терминов и постингов.</p></li>
<li><p>Администраторские функции: получение списка пользователей, его модификация, передача списка на сервер, создание и удаление баз данных.</p></li>
</ul>
<p>Пакет состоит из одного файла <code class="docutils literal notranslate"><span class="pre">PhpIrbis.php</span></code> и зависит от трёх расширений: <code class="docutils literal notranslate"><span class="pre">mbstring</span></code>, <code class="docutils literal notranslate"><span class="pre">json</span></code> и <code class="docutils literal notranslate"><span class="pre">sockets</span></code>, входящих в стандартную поставку PHP. В операционной системе Linux с PHP 7 может потребоваться установить пакет <code class="docutils literal notranslate"><span class="pre">php-mbstring</span></code> с помощью системного пакетного менеджера, например, так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">php</span><span class="o">-</span><span class="n">mbstring</span>
</pre></div>
</div>
<p>Поддерживается PHP, начиная с версии 5.4 (как 32-битные, так и 64-битные версии интерпретатора) и сервер ИРБИС64, начиная с 2014. Более ранние версии PHP будут выдавать ошибки, т. к. пакет использует языковые возможности, появившиеся в PHP 5.4. Аналогично обстоит дело и с более ранними версиями сервера ИРБИС64.</p>
<p><strong>ВАЖНО</strong> В <code class="docutils literal notranslate"><span class="pre">PhpIrbis</span></code> предполагается, что системная кодировка символов PHP – UTF-8. В большинстве случаев это так, но если системная кодировка будет переопределена, то часть строк, участвующих в обмене с сервером, будет испорчена.</p>
</div>
<div class="section" id="id2">
<h2>Установка<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">PhpIrbis</span></code> можно загрузить с GitHub: [<a class="reference external" href="https://github.com/amironov73/PhpIrbis](https://github.com/amironov73/PhpIrbis">https://github.com/amironov73/PhpIrbis](https://github.com/amironov73/PhpIrbis</a>). Подключение <cite>PhpIrbis</cite> к своему проекту в этом случае тривиально: достаточно скачать с GitHub файл <cite>PhpIrbis.php</cite>, положить его рядом с другими файлами с исходным кодом и сослаться на него, например, в директиве <cite>require</cite> или <cite>include</cite>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">require_once &#39;PhpIrbis.php&#39;;</span>
</pre></div>
</div>
<p>Файл <code class="docutils literal notranslate"><span class="pre">PhpIrbis.php</span></code> содержит в себе весь необходимый код.</p>
<p>Однако предпочтительным способом является подключение библиотеки <cite>PhpIrbis</cite> с помощью Composer:</p>
<img alt="Подключение в интерфейсе PhpStorm" src="_images/phpstorm.png" />
<p>В файле <code class="docutils literal notranslate"><span class="pre">composer.json</span></code> достаточно добавить директиву <code class="docutils literal notranslate"><span class="pre">require</span></code>, ссылающуюся на пакет <code class="docutils literal notranslate"><span class="pre">amironov73/phpirbis</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vendor_name/package_name&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;description_text&quot;</span><span class="p">,</span>
  <span class="nt">&quot;require&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;amironov73/phpirbis&quot;</span><span class="p">:</span> <span class="s2">&quot;dev-master&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Composer создаёт в файле <code class="docutils literal notranslate"><span class="pre">vendor/autoload.php</span></code> автоматический загрузчик классов, которым можно воспользоваться так:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">// подключаем сгенерированный загрузчик</span>
<span class="x">require __DIR__ . &#39;/../vendor/autoload.php&#39;;</span>

<span class="x">$connection = new Irbis\Connection();</span>
<span class="x">$record = new Irbis\MarcRecord();</span>
<span class="x">// и так далее</span>
</pre></div>
</div>
<p>Классы и функции пакета <code class="docutils literal notranslate"><span class="pre">PhpIrbis</span></code> помещены в пространство имён <code class="docutils literal notranslate"><span class="pre">Irbis</span></code> (см. предыдущий пример кода).</p>
</div>
<div class="section" id="id3">
<h2>Примеры программ<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h2>
<p>Ниже прилагается пример простой программы. Сначала находятся и загружаются 10 первых библиографических записей, в которых автором является А. С. Пушкин. Показано нахождение значения поля с заданным тегом и подполя с заданным кодом. Также показано расформатирование записи в формат <code class="docutils literal notranslate"><span class="pre">brief</span></code>.</p>
<p><strong>ВАЖНО!</strong> Обратите внимание, что <code class="docutils literal notranslate"><span class="pre">PhpIrbis</span></code> полагается на то, что исходные тексты программ записаны в системной кодировке UTF-8. Поэтому, если кодировка исходных текстов будет отличаться от ожидаемой, литералы будут искажены и программа может перестать работать.</p>
<p>Лучший вариант – избегать употребления в тексте программы литералов с национальными символами. В наших примерах такие литералы употребляются исключительно для простоты изложения.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">require_once &#39;PhpIrbis.php&#39;;</span>

<span class="x">try {</span>

<span class="x">    // Подключаемся к серверу</span>
<span class="x">    $connection = new Irbis\Connection();</span>
<span class="x">    $connectString = &#39;host=127.0.0.1;user=librarian;password=secret;&#39;;</span>
<span class="x">    $connection-&gt;parseConnectionString($connectString);</span>

<span class="x">    if (!$connection-&gt;connect()) {</span>
<span class="x">        echo &quot;Не удалось подключиться!&quot;;</span>
<span class="x">        echo Irbis\describe_error($connection-&gt;lastError);</span>
<span class="x">        die(1);</span>
<span class="x">    }</span>

<span class="x">    // Общие сведения о сервере</span>
<span class="x">    echo &quot;&lt;p&gt;Версия сервера: &lt;b&gt;{$connection-&gt;serverVersion}&lt;/b&gt;&lt;br/&gt;&quot;;</span>
<span class="x">    echo &quot;Интервал: &lt;b&gt;{$connection-&gt;interval}&lt;/b&gt; мин.&lt;br/&gt;&quot;;</span>

<span class="x">    // Из INI-файла можно получить настройки для клиента</span>
<span class="x">    $ini = $connection-&gt;iniFile;</span>
<span class="x">    $dbnnamecat = $ini-&gt;getValue(&#39;Main&#39;, &#39;DBNNAMECAT&#39;);</span>
<span class="x">    echo &quot;DBNNAMECAT: &lt;b&gt;{$dbnnamecat}&lt;/b&gt;&lt;/p&gt;\n&quot;;</span>

<span class="x">    // Получаем список доступных баз данных</span>
<span class="x">    $databases = $connection-&gt;listDatabases(&#39;1..&#39; . $dbnnamecat);</span>
<span class="x">    echo &quot;&lt;p&gt;Имеются базы данных: &lt;b&gt;&quot; . implode(&#39;, &#39;, $databases) . &quot;&lt;/b&gt;&lt;/p&gt;\n&quot;;</span>

<span class="x">    // Находим записи с автором &quot;Пушкин&quot;</span>
<span class="x">    $found = $connection-&gt;search(&#39;&quot;A=Пушкин$&quot;&#39;);</span>
<span class="x">    echo &quot;&lt;p&gt;Всего найдено записей: &quot; . count($found) . &quot;&lt;/p&gt;\n&quot;;</span>

<span class="x">    if (count($found) &gt; 10) {</span>
<span class="x">        // Ограничиваемся первыми 10 записями</span>
<span class="x">        $found = array_slice($found, 0, 10);</span>
<span class="x">    }</span>

<span class="x">    foreach ($found as $mfn) {</span>
<span class="x">        // Считываем запись с сервера</span>
<span class="x">        $record = $connection-&gt;readRecord($mfn);</span>

<span class="x">        // Получаем значение поля/подполя</span>
<span class="x">        $title = $record-&gt;fm(200, &#39;a&#39;);</span>
<span class="x">        echo &quot;&lt;p&gt;&lt;b&gt;Заглавие:&lt;/b&gt; {$title}&lt;br/&gt;&quot;;</span>

<span class="x">        // Расформатируем запись на севере</span>
<span class="x">        $description = $connection-&gt;formatRecord(&#39;@brief&#39;, $mfn);</span>
<span class="x">        echo &quot;&lt;b&gt;Биб. описание:&lt;/b&gt; {$description}&lt;/p&gt;\n&quot;;</span>
<span class="x">    }</span>

<span class="x">    // Отключаемся от сервера</span>
<span class="x">    $connection-&gt;disconnect();</span>
<span class="x">}</span>
<span class="x">catch (Exception $exception) {</span>
<span class="x">    echo &quot;ОШИБКА: &quot; . $exception;</span>
<span class="x">}</span>
</pre></div>
</div>
<p>Вышеприведённая программа сгенерирует примерно такую веб-страницу:</p>
<img alt="example1" src="_images/example1.png" />
<p>В следующей программе создается и отправляется на сервер 10 записей. Показано добавление в запись полей с подполями.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">require_once &#39;PhpIrbis.php&#39;;</span>

<span class="x">try {</span>

<span class="x">    // Подключаемся к серверу</span>
<span class="x">    $connection = new Irbis\Connection();</span>
<span class="x">    $connectString = &#39;host=127.0.0.1;user=librarian;password=secret;&#39;;</span>
<span class="x">    $connection-&gt;parseConnectionString($connectString);</span>

<span class="x">    if (!$connection-&gt;connect()) {</span>
<span class="x">        echo &quot;Не удалось подключиться!&quot;;</span>
<span class="x">        echo Irbis\describe_error($connection-&gt;lastError);</span>
<span class="x">        die(1);</span>
<span class="x">    }</span>

<span class="x">    // Записи будут помещаться в базу SANDBOX</span>
<span class="x">    $connection-&gt;database = &#39;SANDBOX&#39;;</span>

<span class="x">    for ($i = 0; $i &lt; 10; $i++) {</span>
<span class="x">        // Создаем запись</span>
<span class="x">        $record = new Irbis\MarcRecord();</span>

<span class="x">        // Наполняем ее полями: первый автор (поле с подолями),</span>
<span class="x">        $record-&gt;add(700)</span>
<span class="x">            -&gt;add(&#39;a&#39;, &#39;Миронов&#39;)</span>
<span class="x">            -&gt;add(&#39;b&#39;, &#39;А. В.&#39;)</span>
<span class="x">            -&gt;add(&#39;g&#39;, &#39;Алексей Владимирович&#39;);</span>

<span class="x">        // заглавие (поле с подполями),</span>
<span class="x">        $record-&gt;add(200)</span>
<span class="x">            -&gt;add(&#39;a&#39;, &quot;Работа ИРБИС64: версия {$i}.0&quot;)</span>
<span class="x">            -&gt;add(&#39;e&#39;, &#39;руководство пользователя&#39;);</span>

<span class="x">        // выходные данные (поле с подполями),</span>
<span class="x">        $record-&gt;add(210)</span>
<span class="x">            -&gt;add(&#39;a&#39;, &#39;Иркутск&#39;)</span>
<span class="x">            -&gt;add(&#39;c&#39;, &#39;ИРНИТУ&#39;)</span>
<span class="x">            -&gt;add(&#39;d&#39;, &#39;2018&#39;);</span>

<span class="x">        // рабочий лист (поле без подполей).</span>
<span class="x">        $record-&gt;add(920, &#39;PAZK&#39;);</span>

<span class="x">        // Отсылаем запись на сервер.</span>
<span class="x">        // Обратно приходит запись,</span>
<span class="x">        // обработанная AUTOIN.GBL.</span>
<span class="x">        $connection-&gt;writeRecord($record);</span>

<span class="x">        // Распечатываем обработанную запись</span>
<span class="x">        echo &#39;&lt;p&gt;&#39; . $record-&gt;encode(&#39;&lt;br/&gt;&#39;) . &#39;&lt;/p&gt;&#39;;</span>
<span class="x">    }</span>

<span class="x">    // Отключаемся от сервера</span>
<span class="x">    $connection-&gt;disconnect();</span>
<span class="x">}</span>
<span class="x">catch (Exception $exception) {</span>
<span class="x">    echo &quot;ОШИБКА: &quot; . $exception;</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="chapter2.html" class="btn btn-neutral float-right" title="Класс Connection" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Библиотека PhpIrbis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018-2021, Alexey Mironov &lt;amironov73@gmail.com&gt;.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>